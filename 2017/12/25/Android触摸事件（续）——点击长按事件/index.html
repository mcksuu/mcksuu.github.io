<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Nick, Ksuu" />








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.png?v=5.1.0" />






<meta name="description" content="&amp;#x6628;&amp;#x5929;&amp;#x5199;&amp;#x5B8C;&amp;#x4E86;Android&amp;#x89E6;&amp;#x6478;&amp;#x4E8B;&amp;#x4EF6;&amp;#xFF08;&amp;#x4E0B;&amp;#xFF09;&amp;#x2014;&amp;#x2014;&amp;#x4E8B;&amp;#x4EF6;&amp;#x7684;&amp;#x5206;&amp;#x53D1;&amp;#xFF0C;&amp;#x5199;&amp;#x5B8C;&amp;#x540E;&amp;#x4EE5;&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="Android触摸事件（续）——点击长按事件">
<meta property="og:url" content="https://mcksuu.github.io/2017/12/25/Android触摸事件（续）——点击长按事件/index.html">
<meta property="og:site_name" content="McKsuu">
<meta property="og:description" content="&amp;#x6628;&amp;#x5929;&amp;#x5199;&amp;#x5B8C;&amp;#x4E86;Android&amp;#x89E6;&amp;#x6478;&amp;#x4E8B;&amp;#x4EF6;&amp;#xFF08;&amp;#x4E0B;&amp;#xFF09;&amp;#x2014;&amp;#x2014;&amp;#x4E8B;&amp;#x4EF6;&amp;#x7684;&amp;#x5206;&amp;#x53D1;&amp;#xFF0C;&amp;#x5199;&amp;#x5B8C;&amp;#x540E;&amp;#x4EE5;&amp;">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/5720362-d433f064af638bba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/5720362-465dbfe021266592.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/5720362-ce8b4a43e758a1c3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/5720362-8d12cea30a0510d7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/5720362-7ba0e9f79e8e5479.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2018-01-15T15:00:29.083Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android触摸事件（续）——点击长按事件">
<meta name="twitter:description" content="&amp;#x6628;&amp;#x5929;&amp;#x5199;&amp;#x5B8C;&amp;#x4E86;Android&amp;#x89E6;&amp;#x6478;&amp;#x4E8B;&amp;#x4EF6;&amp;#xFF08;&amp;#x4E0B;&amp;#xFF09;&amp;#x2014;&amp;#x2014;&amp;#x4E8B;&amp;#x4EF6;&amp;#x7684;&amp;#x5206;&amp;#x53D1;&amp;#xFF0C;&amp;#x5199;&amp;#x5B8C;&amp;#x540E;&amp;#x4EE5;&amp;">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/5720362-d433f064af638bba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://mcksuu.github.io/2017/12/25/Android触摸事件（续）——点击长按事件/"/>





  <title> Android触摸事件（续）——点击长按事件 | McKsuu </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">McKsuu</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle">McKsuu</p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://mcksuu.github.io/2017/12/25/Android触摸事件（续）——点击长按事件/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Nick Kang">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/favicon.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="McKsuu">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="McKsuu" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Android触摸事件（续）——点击长按事件
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="post.created" itemprop="dateCreated datePublished" datetime="2017-12-25T21:11:18+08:00">
                2017-12-25
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>&#x6628;&#x5929;&#x5199;&#x5B8C;&#x4E86;<a href="http://ksuu.group/2017/12/20/Android%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6%EF%BC%88%E4%B8%8B%EF%BC%89%E2%80%94%E2%80%94%E4%BA%8B%E4%BB%B6%E7%9A%84%E5%88%86%E5%8F%91/#more" target="_blank" rel="external">Android&#x89E6;&#x6478;&#x4E8B;&#x4EF6;&#xFF08;&#x4E0B;&#xFF09;&#x2014;&#x2014;&#x4E8B;&#x4EF6;&#x7684;&#x5206;&#x53D1;</a>&#xFF0C;&#x5199;&#x5B8C;&#x540E;&#x4EE5;&#x4E3A;&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#x7EC8;&#x5C06;&#x544A;&#x4E00;&#x6BB5;&#x843D;&#x4E86;&#x3002;&#x4ECA;&#x65E9;&#x65E0;&#x610F;&#x95F4;&#x7A81;&#x7136;&#x60F3;&#x8D77;&#xFF0C;&#x597D;&#x50CF;&#x5173;&#x4E8E;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x3001;&#x957F;&#x6309;&#x4E8B;&#x4EF6;&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#x5E76;&#x6CA1;&#x6709;&#x5206;&#x6790;&#x554A;&#xFF01;&#xFF01;&#x5782;&#x6B7B;&#x75C5;&#x4E2D;&#x60CA;&#x5750;&#x8D77;&#xFF0C;&#x7C97;&#x7565;&#x7684;&#x770B;&#x4E86;&#x4E0B;&#x6E90;&#x7801;&#xFF0C;&#x597D;&#x50CF;&#x6CA1;&#x5565;&#x4E1C;&#x897F;&#x554A;&#x3002;&#x4ED4;&#x7EC6;&#x770B;&#x770B;&#x5427;&#xFF0C;&#x53D1;&#x73B0;&#x6709;&#x4E9B;&#x5730;&#x65B9;&#x771F;&#x7684;&#x662F;&#x53EB;&#x4EBA;&#x5934;&#x75BC;&#x3002;&#x6CA1;&#x529E;&#x6CD5;&#xFF0C;&#x4ED4;&#x7EC6;&#x770B;&#x5427;&#x770B;&#x5427;&#x3002;&#x6B63;&#x662F;&#xFF1A;<br><strong>&#x7801;&#x4E2D;&#x81EA;&#x6709;&#x989C;&#x5982;&#x7389;&#xFF0C;&#x7801;&#x4E2D;&#x81EA;&#x6709;&#x9EC4;&#x91D1;&#x5C4B;&#x3002;</strong><br><img src="http://upload-images.jianshu.io/upload_images/5720362-d433f064af638bba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h1 id="onTouchEvent&#x4F1A;&#x8FDF;&#x5230;&#xFF0C;&#x6709;&#x65F6;&#x4E5F;&#x4F1A;&#x7F3A;&#x5E2D;"><a href="#onTouchEvent&#x4F1A;&#x8FDF;&#x5230;&#xFF0C;&#x6709;&#x65F6;&#x4E5F;&#x4F1A;&#x7F3A;&#x5E2D;" class="headerlink" title="onTouchEvent&#x4F1A;&#x8FDF;&#x5230;&#xFF0C;&#x6709;&#x65F6;&#x4E5F;&#x4F1A;&#x7F3A;&#x5E2D;"></a>onTouchEvent&#x4F1A;&#x8FDF;&#x5230;&#xFF0C;&#x6709;&#x65F6;&#x4E5F;&#x4F1A;&#x7F3A;&#x5E2D;</h1><p><a href="http://ksuu.group/2017/12/20/Android%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6%EF%BC%88%E4%B8%8B%EF%BC%89%E2%80%94%E2%80%94%E4%BA%8B%E4%BB%B6%E7%9A%84%E5%88%86%E5%8F%91/#more" target="_blank" rel="external">Android&#x89E6;&#x6478;&#x4E8B;&#x4EF6;&#xFF08;&#x4E0B;&#xFF09;&#x2014;&#x2014;&#x4E8B;&#x4EF6;&#x7684;&#x5206;&#x53D1;</a>&#x4E2D;&#x5199;&#x8FC7;&#xFF1A;</p>
<ol>
<li>&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;OnTouchListener&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#x4F1A;&#x5148;&#x6267;&#x884C;OnTouchListener&#x7684;onTouch&#x65B9;&#x6CD5;&#xFF0C;&#x63A5;&#x7740;&#x6839;&#x636E;&#x8FD4;&#x56DE;&#x503C;&#x6765;&#x786E;&#x5B9A;&#x662F;&#x5426;&#x9700;&#x8981;&#x6267;&#x884C;onTouchEvent&#x65B9;&#x6CD5;&#x3002;</li>
<li>onTouchEvent&#x662F;&#x5426;&#x9700;&#x8981;&#x8C03;&#x7528;&#x662F;&#x548C;result&#x7684;&#x503C;&#x6709;&#x5173;&#xFF1A;&#x5982;&#x679C;result&#x4E3A;true&#xFF0C;&#x5219;&#x4E0D;&#x8C03;&#x7528;&#xFF1B;&#x53CD;&#x4E4B;&#xFF0C;&#x5219;&#x8C03;&#x7528;&#x3002;</li>
</ol>
<p>&#x6240;&#x4EE5;&#x8BF4;&#xFF1A;<strong>onTouchEvent&#x4F1A;&#x8FDF;&#x5230;&#xFF0C;&#x6709;&#x65F6;&#x4E5F;&#x4F1A;&#x7F3A;&#x5E2D;</strong>&#x3002;&#x4E0D;&#x8FC7;&#x7F3A;&#x5E2D;&#x7684;&#x65F6;&#x5019;&#x5E76;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x5173;&#x5FC3;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x770B;&#x4E0B;&#x6B63;&#x5E38;&#x6D41;&#x7A0B;&#x4E2D;<code>onTouchEvent</code>&#x5230;&#x5E95;&#x505A;&#x4E86;&#x4EC0;&#x4E48;&#xFF1A;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div></pre></td><td class="code"><pre><div class="line">public boolean onTouchEvent(MotionEvent event) {</div><div class="line">	final float x = event.getX();</div><div class="line">	final float y = event.getY();</div><div class="line">	final int viewFlags = mViewFlags;</div><div class="line">	final int action = event.getAction();</div><div class="line"></div><div class="line">	// &#x5224;&#x65AD;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x70B9;&#x51FB;</div><div class="line">	final boolean clickable = ((viewFlags &amp; CLICKABLE) == CLICKABLE</div><div class="line">			|| (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE)</div><div class="line">			|| (viewFlags &amp; CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE;</div><div class="line">	// View&#x662F;&#x5426;&#x4E0D;&#x53EF;&#x7528;&#xFF1A;&#x5982;&#x679C;&#x4E0D;&#x53EF;&#x7528;&#xFF0C;&#x8FD4;&#x56DE;&#x503C;&#x662F;&#x662F;&#x5426;&#x53EF;&#x70B9;&#x51FB;</div><div class="line">	// &#x6CE8;&#x91CA;&#xFF1A;&#x4E0D;&#x53EF;&#x7528;&#x7684;&#x4F46;&#x662F;&#x53EF;&#x70B9;&#x51FB;&#x7684;View&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x89E6;&#x6478;&#x4E8B;&#x4EF6;&#xFF0C;&#x4EC5;&#x4EC5;&#x662F;&#x4E0D;&#x54CD;&#x5E94;&#x4ED6;&#x4EEC;</div><div class="line">	if ((viewFlags &amp; ENABLED_MASK) == DISABLED) {</div><div class="line">		if (action == MotionEvent.ACTION_UP &amp;&amp; (mPrivateFlags &amp; PFLAG_PRESSED) != 0) {</div><div class="line">			setPressed(false);</div><div class="line">		}</div><div class="line">		mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;</div><div class="line">		// A disabled view that is clickable still consumes the touch</div><div class="line">		// events, it just doesn&apos;t respond to them.</div><div class="line">		return clickable;</div><div class="line">	}</div><div class="line">	if (mTouchDelegate != null) {</div><div class="line">		if (mTouchDelegate.onTouchEvent(event)) {</div><div class="line">			return true;</div><div class="line">		}</div><div class="line">	}</div><div class="line">	</div><div class="line">	// &#x53EF;&#x70B9;&#x51FB;&#x6216;&#x8005;&#x6709;&#x6807;&#x5FD7;&#x4F4D;TOOLTIP</div><div class="line">	if (clickable || (viewFlags &amp; TOOLTIP) == TOOLTIP) {</div><div class="line">		switch (action) {</div><div class="line">			// &#x62AC;&#x8D77;&#x65F6;&#x8FDB;&#x884C;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x8FD9;&#x91CC;&#x9762;&#x6709;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x7684;&#x8C03;&#x7528;</div><div class="line">			case MotionEvent.ACTION_UP:</div><div class="line">				mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;</div><div class="line">				if ((viewFlags &amp; TOOLTIP) == TOOLTIP) {</div><div class="line">					handleTooltipUp();</div><div class="line">				}</div><div class="line">				// &#x5982;&#x679C;&#x4E0D;&#x53EF;&#x70B9;&#x51FB;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x628A;callBack&#x79FB;&#x9664;</div><div class="line">				if (!clickable) {</div><div class="line">					removeTapCallback();</div><div class="line">					removeLongPressCallback();</div><div class="line">					mInContextButtonPress = false;</div><div class="line">					mHasPerformedLongPress = false;</div><div class="line">					mIgnoreNextUpEvent = false;</div><div class="line">					break;</div><div class="line">				}</div><div class="line">				// &#x8FD9;&#x91CC;Prepressed&#x4E5F;&#x7528;&#x4E8E;&#x8BC6;&#x522B;&#x5FEB;&#x901F;&#x6309;&#x4E0B;</div><div class="line">				boolean prepressed = (mPrivateFlags &amp; PFLAG_PREPRESSED) != 0;</div><div class="line">				// &#x5982;&#x679C;&#x6309;&#x4E0B;&#x6216;&#x8005;&#x5FEB;&#x901F;&#x6309;&#x4E0B;</div><div class="line">				if ((mPrivateFlags &amp; PFLAG_PRESSED) != 0 || prepressed) {</div><div class="line">					// take focus if we don&apos;t have it already and we should in</div><div class="line">					// touch mode.</div><div class="line">					// &#x5982;&#x679C;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x83B7;&#x5F97;&#x7126;&#x70B9;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x8981;&#x6839;&#x636E;&#x89E6;&#x6478;&#x6A21;&#x5F0F;&#x6765;&#x5224;&#x65AD;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x7126;&#x70B9;</div><div class="line">					// &#x8FD9;&#x91CC;&#x95EE;&#x9898;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x540E;&#x9762;&#x4F1A;&#x8BF4;</div><div class="line">					boolean focusTaken = false;</div><div class="line">					if (isFocusable() &amp;&amp; isFocusableInTouchMode() &amp;&amp; !isFocused()) {</div><div class="line">						focusTaken = requestFocus();</div><div class="line">					}</div><div class="line"></div><div class="line">					if (prepressed) {</div><div class="line">						// The button is being released before we actually</div><div class="line">						// showed it as pressed.  Make it show the pressed</div><div class="line">						// state now (before scheduling the click) to ensure</div><div class="line">						// the user sees it.</div><div class="line">						// &#x6309;&#x4E0B;&#x6309;&#x94AE;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x91CA;&#x653E;&#x6309;&#x94AE;&#x3002; &#x73B0;&#x5728;&#x663E;&#x793A;&#x6309;&#x4E0B;&#x7684;&#x72B6;&#x6001;&#xFF08;&#x8C03;&#x5EA6;&#x70B9;&#x51FB;&#x4E4B;&#x524D;&#xFF09;&#xFF0C;&#x4EE5;&#x786E;&#x4FDD;&#x7528;&#x6237;&#x770B;&#x5230;&#x5B83;&#x3002;</div><div class="line">						setPressed(true, x, y);</div><div class="line">					}</div><div class="line"></div><div class="line">					// &#x5982;&#x679C;&#x6CA1;&#x6709;&#x6267;&#x884C;&#x957F;&#x6309;&#x4E8B;&#x4EF6;&#x5E76;&#x4E14;&#x4E0D;&#x5FFD;&#x7565;&#x4E0B;&#x6B21;&#x62AC;&#x8D77;&#x4E8B;&#x4EF6;</div><div class="line">					if (!mHasPerformedLongPress &amp;&amp; !mIgnoreNextUpEvent) {</div><div class="line">						// This is a tap, so remove the longpress check</div><div class="line">						// &#x8FD9;&#x662F;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x79FB;&#x9664;&#x6389;&#x957F;&#x6309;&#x4E8B;&#x4EF6;&#x7684;&#x68C0;&#x67E5;</div><div class="line">						removeLongPressCallback();</div><div class="line"></div><div class="line">						// Only perform take click actions if we were in the pressed state</div><div class="line">						// &#x5982;&#x679C;&#x5F53;&#x524D;View&#x5DF2;&#x7ECF;&#x83B7;&#x5F97;&#x7126;&#x70B9;&#x6216;&#x8005;&#x89E6;&#x6478;&#x6A21;&#x5F0F;&#x4E3A;false</div><div class="line">						if (!focusTaken) {</div><div class="line">							// Use a Runnable and post this rather than calling</div><div class="line">							// performClick directly. This lets other visual state</div><div class="line">							// of the view update before click actions start.</div><div class="line">							// &#x901A;&#x8FC7;performClick&#x6267;&#x884C;click&#x4E8B;&#x4EF6;</div><div class="line">							if (mPerformClick == null) {</div><div class="line">								mPerformClick = new PerformClick();</div><div class="line">							}</div><div class="line">							if (!post(mPerformClick)) {</div><div class="line">								performClick();</div><div class="line">							}</div><div class="line">						}</div><div class="line">					}</div><div class="line"></div><div class="line">					if (mUnsetPressedState == null) {</div><div class="line">						mUnsetPressedState = new UnsetPressedState();</div><div class="line">					}</div><div class="line"></div><div class="line">					if (prepressed) {</div><div class="line">						postDelayed(mUnsetPressedState,</div><div class="line">								ViewConfiguration.getPressedStateDuration());</div><div class="line">					} else if (!post(mUnsetPressedState)) {</div><div class="line">						// If the post failed, unpress right now</div><div class="line">						mUnsetPressedState.run();</div><div class="line">					}</div><div class="line"></div><div class="line">					removeTapCallback();</div><div class="line">				}</div><div class="line">				mIgnoreNextUpEvent = false;</div><div class="line">				break;</div><div class="line"></div><div class="line">			case MotionEvent.ACTION_DOWN:</div><div class="line">				if (event.getSource() == InputDevice.SOURCE_TOUCHSCREEN) {</div><div class="line">					mPrivateFlags3 |= PFLAG3_FINGER_DOWN;</div><div class="line">				}</div><div class="line">				mHasPerformedLongPress = false;</div><div class="line">				// &#x5982;&#x679C;&#x4E0D;&#x53EF;&#x70B9;&#x51FB;&#xFF0C;&#x90A3;&#x4E48;&#x68C0;&#x67E5;&#x957F;&#x6309;&#x4E8B;&#x4EF6;</div><div class="line">				if (!clickable) {</div><div class="line">					checkForLongClick(0, x, y);</div><div class="line">					break;</div><div class="line">				}</div><div class="line"></div><div class="line">				if (performButtonActionOnTouchDown(event)) {</div><div class="line">					break;</div><div class="line">				}</div><div class="line"></div><div class="line">				// Walk up the hierarchy to determine if we&apos;re inside a scrolling container.</div><div class="line">				boolean isInScrollingContainer = isInScrollingContainer();</div><div class="line">				// &#x5982;&#x679C;View&#x5728;&#x6B63;&#x5728;&#x6EDA;&#x52A8;&#x7684;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x90A3;&#x4E48;&#x5EF6;&#x8FDF;&#x53D1;&#x9001;&#x8FD9;&#x6761;&#x6D88;&#x606F;</div><div class="line">				// For views inside a scrolling container, delay the pressed feedback for</div><div class="line">				// a short period in case this is a scroll.</div><div class="line">				if (isInScrollingContainer) {</div><div class="line">					mPrivateFlags |= PFLAG_PREPRESSED;</div><div class="line">					if (mPendingCheckForTap == null) {</div><div class="line">						mPendingCheckForTap = new CheckForTap();</div><div class="line">					}</div><div class="line">					mPendingCheckForTap.x = event.getX();</div><div class="line">					mPendingCheckForTap.y = event.getY();</div><div class="line">					postDelayed(mPendingCheckForTap, ViewConfiguration.getTapTimeout());</div><div class="line">				} else {</div><div class="line">					// Not inside a scrolling container, so show the feedback right away</div><div class="line">					// &#x4E0D;&#x5728;&#x6B63;&#x5728;&#x6EDA;&#x52A8;&#x7684;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x76F4;&#x63A5;&#x8BBE;&#x7F6E;&#x6309;&#x4E0B;&#xFF0C;&#x5E76;&#x68C0;&#x67E5;&#x957F;&#x6309;&#x4E8B;&#x4EF6;</div><div class="line">					setPressed(true, x, y);</div><div class="line">					checkForLongClick(0, x, y);</div><div class="line">				}</div><div class="line">				break;</div><div class="line">	</div><div class="line">			// &#x53D6;&#x6D88;&#xFF0C;&#x79FB;&#x9664;callBack</div><div class="line">			case MotionEvent.ACTION_CANCEL:</div><div class="line">				if (clickable) {</div><div class="line">					setPressed(false);</div><div class="line">				}</div><div class="line">				removeTapCallback();</div><div class="line">				removeLongPressCallback();</div><div class="line">				mInContextButtonPress = false;</div><div class="line">				mHasPerformedLongPress = false;</div><div class="line">				mIgnoreNextUpEvent = false;</div><div class="line">				mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;</div><div class="line">				break;</div><div class="line">			// &#x79FB;&#x52A8;</div><div class="line">			case MotionEvent.ACTION_MOVE:</div><div class="line">				if (clickable) {</div><div class="line">					drawableHotspotChanged(x, y);</div><div class="line">				}</div><div class="line"></div><div class="line">				// Be lenient about moving outside of buttons</div><div class="line">				if (!pointInView(x, y, mTouchSlop)) {</div><div class="line">					// Outside button</div><div class="line">					// Remove any future long press/tap checks</div><div class="line">					removeTapCallback();</div><div class="line">					removeLongPressCallback();</div><div class="line">					if ((mPrivateFlags &amp; PFLAG_PRESSED) != 0) {</div><div class="line">						setPressed(false);</div><div class="line">					}</div><div class="line">					mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;</div><div class="line">				}</div><div class="line">				break;</div><div class="line">		}</div><div class="line"></div><div class="line">		return true;</div><div class="line">	}</div><div class="line"></div><div class="line">	return false;</div><div class="line">}</div></pre></td></tr></table></figure></p>
<p>&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x53BB;&#x9664;&#x6CE8;&#x91CA;&#xFF0C;&#x53BB;&#x9664;&#x79FB;&#x52A8;&#x548C;&#x53D6;&#x6D88;&#x52A8;&#x4F5C;&#xFF0C;&#x771F;&#x6B63;&#x7684;&#x4EE3;&#x7801;&#x5E76;&#x4E0D;&#x591A;&#xFF1A;</p>
<ol>
<li><strong>&#x5224;&#x65AD;View&#x662F;&#x5426;&#x4E0D;&#x53EF;&#x7528;&#xFF1A;&#x5982;&#x679C;&#x4E0D;&#x53EF;&#x7528;&#xFF0C;&#x90A3;&#x4E48;onTouchEvent&#x8FD4;&#x56DE;&#x503C;&#x662F;&#x5426;&#x53EF;&#x70B9;&#x51FB;&#xFF08;clickable &#xFF09;</strong></li>
<li><strong>&#x5982;&#x679C;View&#x53EF;&#x4EE5;&#x70B9;&#x51FB;&#x6216;&#x8005;&#x6709;TOOLTIP&#x6807;&#x5FD7;&#x4F4D;&#x7684;&#x8BDD;&#xFF0C;&#x5219;&#x8FDB;&#x884C;&#x5BF9;&#x4E8B;&#x4EF6;&#x7684;&#x4E0D;&#x540C;&#x52A8;&#x4F5C;&#x7684;&#x5904;&#x7406;&#x3002;</strong></li>
</ol>
<p><strong>ACTION_DOWN</strong>&#xFF1A;&#x4E3B;&#x8981;&#x5305;&#x62EC;&#x4E86;<code>setPressed</code>&#x548C;<code>checkForLongClick</code>&#x4E24;&#x4E2A;&#x64CD;&#x4F5C;&#xFF1A;</p>
<ul>
<li><code>setPressed</code>&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x6309;&#x4E0B;&#x72B6;&#x6001;&#xFF0C;&#x6B64;&#x65F6;<code>PFLAG_PRESSED</code>&#x6807;&#x5FD7;&#x4F4D;&#x88AB;&#x8BBE;&#x7F6E;&#x3002;</li>
<li><code>checkForLongClick</code>&#x7528;&#x4E8E;&#x68C0;&#x67E5;LongClick&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x89E6;&#x53D1;&#xFF0C;&#x4EE5;&#x53CA;&#x53D1;&#x9001;&#x5EF6;&#x8FDF;&#x6D88;&#x606F;&#x6765;&#x54CD;&#x5E94;&#x957F;&#x6309;&#x4E8B;&#x4EF6;&#x3002;<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line">private void checkForLongClick(int delayOffset, float x, float y) {</div><div class="line">	// &#x5982;&#x679C;&#x53EF;&#x4EE5;&#x957F;&#x6309;</div><div class="line">	if ((mViewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE) {</div><div class="line">		mHasPerformedLongPress = false;</div><div class="line"></div><div class="line">		if (mPendingCheckForLongPress == null) {</div><div class="line">			mPendingCheckForLongPress = new CheckForLongPress();</div><div class="line">		}</div><div class="line">		mPendingCheckForLongPress.setAnchor(x, y);</div><div class="line">		mPendingCheckForLongPress.rememberWindowAttachCount();</div><div class="line">		// &#x5EF6;&#x8FDF;&#x6267;&#x884C;CheckForLongPress&#x64CD;&#x4F5C;&#xFF0C;&#x65F6;&#x95F4;&#x9ED8;&#x8BA4;&#x503C; DEFAULT_LONG_PRESS_TIMEOUT = 500ms</div><div class="line">		postDelayed(mPendingCheckForLongPress,</div><div class="line">				ViewConfiguration.getLongPressTimeout() - delayOffset);</div><div class="line">	}</div><div class="line">}</div><div class="line"></div><div class="line">private final class CheckForLongPress implements Runnable {</div><div class="line">	private int mOriginalWindowAttachCount;</div><div class="line">	private float mX;</div><div class="line">	private float mY;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void run() {</div><div class="line">		if (isPressed() &amp;&amp; (mParent != null)</div><div class="line">				&amp;&amp; mOriginalWindowAttachCount == mWindowAttachCount) {</div><div class="line">			// &#x5982;&#x679C;&#x957F;&#x6309;&#x4E8B;&#x4EF6;&#x8FD4;&#x56DE;&#x503C;true&#xFF0C;&#x90A3;&#x4E48;&#x8BBE;&#x7F6E;mHasPerformedLongPress&#x4E3A;true</div><div class="line">			// &#x8868;&#x793A;&#x5DF2;&#x7ECF;&#x6267;&#x884C;&#x4E86;&#x957F;&#x6309;&#x4E8B;&#x4EF6;&#xFF0C;&#x5E76;&#x4E14;&#x8FD4;&#x56DE;&#x503C;&#x4E3A;true</div><div class="line">			if (performLongClick(mX, mY)) {</div><div class="line">				mHasPerformedLongPress = true;</div><div class="line">			}</div><div class="line">		}</div><div class="line">	}</div><div class="line"></div><div class="line">	public void setAnchor(float x, float y) {</div><div class="line">		mX = x;</div><div class="line">		mY = y;</div><div class="line">	}</div><div class="line"></div><div class="line">	public void rememberWindowAttachCount() {</div><div class="line">		mOriginalWindowAttachCount = mWindowAttachCount;</div><div class="line">	}</div><div class="line">}</div><div class="line"></div><div class="line">// &#x6267;&#x884C;&#x957F;&#x6309;&#x4E8B;&#x4EF6;</div><div class="line">public boolean performLongClick(float x, float y) {</div><div class="line">	mLongClickX = x;</div><div class="line">	mLongClickY = y;</div><div class="line">	// &#x8C03;&#x7528;performLongClick()&#x65B9;&#x6CD5;</div><div class="line">	final boolean handled = performLongClick();</div><div class="line">	mLongClickX = Float.NaN;</div><div class="line">	mLongClickY = Float.NaN;</div><div class="line">	return handled;</div><div class="line">}</div><div class="line"></div><div class="line">public boolean performLongClick() {</div><div class="line">	// &#x7EE7;&#x7EED;&#x8C03;&#x7528;</div><div class="line">	return performLongClickInternal(mLongClickX, mLongClickY);</div><div class="line">}</div><div class="line"></div><div class="line">// &#x771F;&#x6B63;&#x6267;&#x884C;&#x957F;&#x6309;&#x65B9;&#x6CD5;	</div><div class="line">private boolean performLongClickInternal(float x, float y) {</div><div class="line">	sendAccessibilityEvent(AccessibilityEvent.TYPE_VIEW_LONG_CLICKED);</div><div class="line"></div><div class="line">	boolean handled = false;</div><div class="line">	// ListenerInfo&#x4E2D;mOnLongClickListener&#x5C5E;&#x6027;&#x662F;&#x5426;&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x4E0D;&#x4E3A;&#x7A7A;&#x5219;&#x6267;&#x884C;onLongClick&#x64CD;&#x4F5C;&#xFF0C;&#x5E76;&#x5C06;&#x8FD4;&#x56DE;&#x503C;&#x8D4B;&#x7ED9;handled</div><div class="line">	final ListenerInfo li = mListenerInfo;</div><div class="line">	if (li != null &amp;&amp; li.mOnLongClickListener != null) {</div><div class="line">		handled = li.mOnLongClickListener.onLongClick(View.this);</div><div class="line">	}</div><div class="line">	if (!handled) {</div><div class="line">		final boolean isAnchored = !Float.isNaN(x) &amp;&amp; !Float.isNaN(y);</div><div class="line">		handled = isAnchored ? showContextMenu(x, y) : showContextMenu();</div><div class="line">	}</div><div class="line">	if (handled) {</div><div class="line">		performHapticFeedback(HapticFeedbackConstants.LONG_PRESS);</div><div class="line">	}</div><div class="line">	return handled;</div><div class="line">}</div></pre></td></tr></table></figure>
</li>
</ul>
<p>&#x6267;&#x884C;&#x957F;&#x6309;&#x8FC7;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x5224;&#x65AD;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x957F;&#x6309;&#xFF0C;&#x53EF;&#x4EE5;&#x7684;&#x8BDD;&#x8FDB;&#x884C;&#x4E0B;&#x9762;&#x64CD;&#x4F5C;&#x3002;&#x8FD9;&#x91CC;&#x5982;&#x679C;&#x5148;&#x8BBE;&#x7F6E;&#x4E0D;&#x53EF;&#x957F;&#x6309;&#x53C8;&#x8BBE;&#x7F6E;<code>OnLongClickListener</code>&#x7684;&#x8BDD;&#xFF0C;&#x6B64;&#x65F6;&#x957F;&#x6309;&#x4E8B;&#x4EF6;&#x4ECD;&#x6709;&#x6548;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x987A;&#x5E8F;&#x98A0;&#x5012;&#x4E0B;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x957F;&#x6309;&#x4E8B;&#x4EF6;&#x5C31;&#x65E0;&#x6548;&#x4E86;&#x3002;</li>
<li>&#x5982;&#x679C;&#x53EF;&#x4EE5;&#x957F;&#x6309;&#xFF0C;&#x90A3;&#x4E48;&#x901A;&#x8FC7;<code>Handler</code>&#x5C06;<code>CheckForLongPress</code>&#x5EF6;&#x8FDF;&#x53D1;&#x9001;&#xFF0C;&#x65F6;&#x95F4;&#x662F;&#x65F6;&#x95F4;&#x9ED8;&#x8BA4;&#x503C; <code>DEFAULT_LONG_PRESS_TIMEOUT = 500ms</code>&#x3002;</li>
<li><code>CheckForLongPress</code>&#x5728;&#x5176;<code>run</code>&#x65B9;&#x6CD5;&#x4E2D;&#x4F1A;&#x6839;&#x636E;<code>performLongClick</code>&#x65B9;&#x6CD5;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x6765;&#x8BBE;&#x7F6E;<code>mHasPerformedLongPress</code>&#x53D8;&#x91CF;&#x7684;&#x503C;&#xFF0C;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x503C;&#x5728;&#x540E;&#x9762;&#x4F1A;&#x7528;&#x5230;&#xFF0C;&#x8FD9;&#x91CC;&#x5148;&#x4E0D;&#x8BF4;&#x3002;</li>
<li>&#x63A5;&#x7740;&#x4F1A;&#x4E00;&#x8DEF;&#x8C03;&#x7528;&#x6700;&#x7EC8;&#x4ECE;<code>ListenerInfo</code>&#x4E2D;&#x83B7;&#x5F97;<code>OnLongClickListener</code>&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x4E3A;<code>null</code>&#xFF0C;&#x5219;&#x6267;&#x884C;&#x5176;<code>onLongClick</code>&#x65B9;&#x6CD5;&#x3002;</li>
</ul>
<p>ACTION_UP&#xFF1A;</p>
<ol>
<li>&#x4E0D;&#x53EF;&#x70B9;&#x51FB;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x628A;callBack&#x79FB;&#x9664;</li>
<li>&#x53EF;&#x4EE5;&#x70B9;&#x51FB;&#x7684;&#x8BDD;&#xFF0C;&#x901A;&#x8FC7;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x70B9;&#x51FB;&#xFF08;<code>clickable</code>&#xFF09;&#x3001;&#x957F;&#x6309;&#x4E8B;&#x4EF6;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#xFF08;<code>mHasPerformedLongPress</code>&#xFF09;&#x3001;&#x662F;&#x5426;&#x5FFD;&#x7565;&#x4E0B;&#x6B21;&#x62AC;&#x8D77;&#xFF08;<code>mIgnoreNextUpEvent</code>&#xFF09;&#x4EE5;&#x53CA;&#x7126;&#x70B9;&#x662F;&#x5426;&#x62FF;&#x5230;&#xFF08;<code>focusTaken</code> &#xFF09;&#x8FD9;&#x56DB;&#x4E2A;&#x503C;&#x6765;&#x5224;&#x65AD;&#x53EF;&#x5426;&#x6267;&#x884C;<code>click</code>&#x4E8B;&#x4EF6;&#x3002;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x535A;&#x5BA2;&#x90FD;&#x4F1A;&#x76F4;&#x63A5;&#x5206;&#x6790;<code>performClick</code>&#x8FC7;&#x7A0B;&#xFF0C;&#x5F88;&#x5C11;&#x4F1A;&#x63D0;&#x5230;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD9;&#x4E2A;&#x6761;&#x4EF6;&#x4F1A;&#x6210;&#x7ACB;&#x3002;&#x6211;&#x8FD9;&#x8FB9;&#x6DF1;&#x7A76;&#x4E00;&#x4E0B;&#xFF0C;&#x770B;&#x4E0B;&#x5230;&#x5E95;&#x4E3A;&#x4EC0;&#x4E48;&#x80FD;&#x591F;&#x6267;&#x884C;<code>performClick</code>&#x64CD;&#x4F5C;&#xFF1A;<br>2.1. <code>prepressed</code>&#x7684;&#x503C;<code>(mPrivateFlags &amp; PFLAG_PREPRESSED) != 0</code>&#xFF0C;&#x8FD9;&#x4E2A;&#x53EF;&#x4EE5;&#x5728;<code>ACTION_DOWN</code>&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8D4B;&#x503C;&#xFF0C;&#x4F46;&#x8D4B;&#x503C;&#x7684;&#x60C5;&#x51B5;&#x662F;&#x5728;&#x6B63;&#x5728;&#x6EDA;&#x52A8;&#x7684;&#x5BB9;&#x5668;&#x4E2D;&#x3002;<br>2.2 <code>(mPrivateFlags &amp; PFLAG_PRESSED)</code>&#x6B64;&#x5904;<code>PFLAG_PRESSED</code>&#x8D4B;&#x503C;&#x540C;&#x6837;&#x4E5F;&#x662F;&#x5728;<code>ACTION_DOWN</code>&#x4E2D;&#x8D4B;&#x503C;&#xFF0C;&#x4E0E;<code>prepressed</code>&#x76F8;&#x53CD;&#xFF0C;&#x6B64;&#x65F6;<code>View</code>&#x4E0D;&#x5728;&#x6B63;&#x5728;&#x6EDA;&#x52A8;&#x7684;&#x5BB9;&#x5668;&#x4E2D;&#x3002;<br>2.3 <code>focusTaken</code>&#x7684;&#x503C;&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x6D89;&#x53CA;&#x7684;&#x4E1C;&#x897F;&#x6709;&#x70B9;&#x591A;&#x3002;&#x9996;&#x5148;&#x5224;&#x65AD;&#x6761;&#x4EF6;<code>isFocusable() &amp;&amp; isFocusableInTouchMode() &amp;&amp; !isFocused()</code>&#xFF1A;<code>isFocusable()</code>&#x4E00;&#x822C;&#x4E3A;<code>true</code>&#xFF1B;<code>isFocusableInTouchMode()</code>&#x5982;&#x679C;&#x4E0D;&#x8BBE;&#x7F6E;<code>setFocusableInTouchMode(true)</code>&#x7684;&#x8BDD;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;<code>false</code>&#xFF1B;<code>isFocused()</code>&#x8FD9;&#x4E2A;&#x503C;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x4E0B;&#xFF0C;&#x6B64;&#x503C;&#x610F;&#x601D;&#x662F;&#x662F;&#x5426;&#x62E5;&#x6709;&#x7126;&#x70B9;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5224;&#x65AD;&#x6761;&#x4EF6;&#x4E3A;<code>!isFocused()</code>&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x524D;&#x9762;&#x6761;&#x4EF6;&#x90FD;&#x4E3A;true&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x82E5;&#x6B64;&#x65F6;<code>isFocused()</code>&#x8FD4;&#x56DE;<code>true</code>&#xFF0C;&#x90A3;&#x4E48;&#x5C06;&#x4E0D;&#x4F1A;&#x518D;&#x6B21;&#x8BF7;&#x6C42;&#x7126;&#x70B9;&#xFF0C;&#x56E0;&#x4E3A;&#x6B64;&#x65F6;&#x5DF2;&#x7ECF;&#x62E5;&#x6709;&#x7126;&#x70B9;&#xFF0C;&#x5426;&#x5219;&#xFF0C;&#x5219;&#x4F1A;&#x8C03;&#x7528;<code>requestFocus</code>&#x83B7;&#x53D6;&#x7126;&#x70B9;&#xFF0C;&#x5E76;&#x5C06;&#x8FD4;&#x56DE;&#x503C;&#x8D4B;&#x7ED9;<code>focusTaken</code>&#x3002;<br>&#x8FD8;&#x662F;&#x6765;&#x770B;&#x4E0B;&#x8FD9;&#x8FB9;&#x7684;&#x4EE3;&#x7801;&#x5427;&#xFF0C;&#x633A;&#x91CD;&#x8981;&#x7684;&#xFF1A;<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">private boolean requestFocusNoSearch(int direction, Rect previouslyFocusedRect) {</div><div class="line">	// need to be focusable</div><div class="line">	if ((mViewFlags &amp; FOCUSABLE) != FOCUSABLE</div><div class="line">			|| (mViewFlags &amp; VISIBILITY_MASK) != VISIBLE) {</div><div class="line">		return false;</div><div class="line">	}</div><div class="line"></div><div class="line">	// need to be focusable in touch mode if in touch mode</div><div class="line">	if (isInTouchMode() &amp;&amp;</div><div class="line">		(FOCUSABLE_IN_TOUCH_MODE != (mViewFlags &amp; FOCUSABLE_IN_TOUCH_MODE))) {</div><div class="line">		   return false;</div><div class="line">	}</div><div class="line"></div><div class="line">	// need to not have any parents blocking us</div><div class="line">	if (hasAncestorThatBlocksDescendantFocus()) {</div><div class="line">		return false;</div><div class="line">	}</div><div class="line"></div><div class="line">	handleFocusGainInternal(direction, previouslyFocusedRect);</div><div class="line">	return true;</div><div class="line">}</div><div class="line"></div><div class="line">private boolean hasAncestorThatBlocksDescendantFocus() {</div><div class="line">	final boolean focusableInTouchMode = isFocusableInTouchMode();</div><div class="line">	ViewParent ancestor = mParent;</div><div class="line">	// &#x67E5;&#x627E;View&#x7684;&#x7236;View&#xFF0C;&#x770B;&#x5176;&#x662F;&#x5426;&#x6709;FOCUS_BLOCK_DESCENDANTS&#x6807;&#x5FD7;&#x4F4D;</div><div class="line">	// &#x8FD9;&#x91CC;&#x51FA;&#x73B0;&#x4E00;&#x4E2A;&#x5E38;&#x7528;&#x7684;&#x53D8;&#x91CF;FOCUS_BLOCK_DESCENDANTS&#xFF0C;&#x8FD9;&#x91CC;&#x662F;&#x5173;&#x4E8E;&#x7126;&#x70B9;&#x8BBE;&#x7F6E;&#xFF0C;&#x540E;&#x9762;&#x6709;&#x4EE3;&#x7801;&#x5206;&#x6790;</div><div class="line">	while (ancestor instanceof ViewGroup) {</div><div class="line">		final ViewGroup vgAncestor = (ViewGroup) ancestor;</div><div class="line">		if (vgAncestor.getDescendantFocusability() == ViewGroup.FOCUS_BLOCK_DESCENDANTS</div><div class="line">				|| (!focusableInTouchMode &amp;&amp; vgAncestor.shouldBlockFocusForTouchscreen())) {</div><div class="line">			return true;</div><div class="line">		} else {</div><div class="line">			ancestor = vgAncestor.getParent();</div><div class="line">		}</div><div class="line">	}</div><div class="line">	return false;</div><div class="line">}</div><div class="line"></div><div class="line">void handleFocusGainInternal(@FocusRealDirection int direction, Rect previouslyFocusedRect) {</div><div class="line">	// &#x5982;&#x679C;&#x6CA1;&#x6709;&#x83B7;&#x53D6;&#x5230;&#x7126;&#x70B9;&#xFF0C;&#x5219;&#x8BBE;&#x7F6E;&#x83B7;&#x53D6;&#x7126;&#x70B9;</div><div class="line">	if ((mPrivateFlags &amp; PFLAG_FOCUSED) == 0) {</div><div class="line">		mPrivateFlags |= PFLAG_FOCUSED;</div><div class="line"></div><div class="line">		View oldFocus = (mAttachInfo != null) ? getRootView().findFocus() : null;</div><div class="line"></div><div class="line">		if (mParent != null) {</div><div class="line">			mParent.requestChildFocus(this, this);</div><div class="line">			updateFocusedInCluster(oldFocus, direction);</div><div class="line">		}</div><div class="line"></div><div class="line">		if (mAttachInfo != null) {</div><div class="line">			mAttachInfo.mTreeObserver.dispatchOnGlobalFocusChange(oldFocus, this);</div><div class="line">		}</div><div class="line"></div><div class="line">		onFocusChanged(true, direction, previouslyFocusedRect);</div><div class="line">		refreshDrawableState();</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>
</li>
</ol>
<p>&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x5F88;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981;&#x5355;&#x72EC;&#x770B;&#x4E00;&#x4E0B;&#x5462;&#xFF1F;&#x9996;&#x5148;&#x6765;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x53BB;&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7126;&#x70B9;&#x7684;&#x8BDD;&#xFF0C;&#x771F;&#x6B63;&#x83B7;&#x53D6;&#x6210;&#x529F;&#x540E;&#x6B64;&#x65F6;&#x8FD4;&#x56DE;&#x503C;&#x4E3A;<code>true</code>&#xFF0C;&#x90A3;&#x4E48;&#x6839;&#x636E;&#x540E;&#x9762;&#x7684;&#x5224;&#x65AD;&#x6761;&#x4EF6;&#x662F;&#x4E0D;&#x4F1A;&#x6267;&#x884C;<code>performClick</code>&#x64CD;&#x4F5C;&#x7684;&#x3002;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x5047;&#x8BBE;&#x6709;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#xFF1A;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">protected void onCreate(Bundle savedInstanceState) {</div><div class="line">        ......</div><div class="line">	View view2 = findViewById(R.id.v_2);</div><div class="line">	view2.setFocusable(true);</div><div class="line">	view2.setFocusableInTouchMode(true);</div><div class="line">	view2.setOnClickListener(new View.OnClickListener() {</div><div class="line">		@Override</div><div class="line">		public void onClick(View v) {</div><div class="line">			Log.d(&quot;fxxk&quot;, &quot;view2 onClick&quot;);</div><div class="line">		}</div><div class="line">	});</div><div class="line">        ......</div><div class="line">}</div></pre></td></tr></table></figure></p>
<p>&#x90A3;&#x4E48;&#x6309;&#x7167;&#x4E0A;&#x9762;&#x7684;&#x5206;&#x6790;&#x6B64;&#x65F6;&#x7B2C;&#x4E00;&#x6B21;&#x70B9;&#x51FB;&#x7684;&#x65F6;&#x5019;&#x5E94;&#x8BE5;&#x4F1A;&#x53BB;&#x8BF7;&#x6C42;&#x7126;&#x70B9;&#x7684;&#xFF0C;&#x6B64;&#x65F6;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x4E0D;&#x4F1A;&#x751F;&#x6548;&#x3002;&#x4F46;&#xFF0C;&#x771F;&#x7684;&#x4F1A;&#x8FD9;&#x6837;&#x5417;&#xFF1F;&#x4E0D;&#x4F1A;&#x7684;&#xFF0C;&#x6700;&#x521D;&#x6211;&#x4EE5;&#x4E3A;&#x4E5F;&#x662F;&#x8FD9;&#x6837;&#xFF0C;&#x4F46;&#x662F;&#x7ECF;&#x8FC7;&#x6D4B;&#x8BD5;&#x53D1;&#x73B0;&#xFF1A;<code>View</code>&#x5728;&#x8BBE;&#x7F6E;&#x6210;&#x53EF;&#x89C1;&#xFF08;<code>VISIBLE</code>&#xFF09;&#x662F;&#xFF0C;&#x4F1A;&#x8C03;&#x7528;<code>mParent.focusableViewAvailable(this);</code>&#x65B9;&#x6CD5;&#x3002;&#x5728;&#x4E4B;&#x524D;<a href="http://ksuu.group/2017/11/13/ActivityLifeCycle/#more" target="_blank" rel="external">&#x4ECE;&#x6E90;&#x7801;&#x5206;&#x6790;Activity&#x542F;&#x52A8;&#x65F6;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;</a>&#x6709;&#x6E90;&#x7801;<code>decor.setVisibility(View.INVISIBLE)</code>&#xFF0C;&#x4E4B;&#x540E;&#x4F1A;&#x8C03;&#x7528;<code>Activity.makeVisible()</code>&#x5C06;<code>mDecor.setVisibility(View.VISIBLE);</code>&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x770B;&#x4E0B;<code>setVisibility</code>&#x65B9;&#x6CD5;&#xFF1A;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">@RemotableViewMethod</div><div class="line">public void setVisibility(@Visibility int visibility) {</div><div class="line">	setFlags(visibility, VISIBILITY_MASK);</div><div class="line">}</div><div class="line"></div><div class="line">void setFlags(int flags, int mask) {</div><div class="line">	final boolean accessibilityEnabled =</div><div class="line">			AccessibilityManager.getInstance(mContext).isEnabled();</div><div class="line">	final boolean oldIncludeForAccessibility = accessibilityEnabled &amp;&amp; includeForAccessibility();</div><div class="line"></div><div class="line">	int old = mViewFlags;</div><div class="line">	mViewFlags = (mViewFlags &amp; ~mask) | (flags &amp; mask);</div><div class="line"></div><div class="line">	int changed = mViewFlags ^ old;</div><div class="line">	if (changed == 0) {</div><div class="line">		return;</div><div class="line">	}</div><div class="line">	......</div><div class="line"></div><div class="line">	final int newVisibility = flags &amp; VISIBILITY_MASK;</div><div class="line">	// &#x5982;&#x679C;&#x65B0;&#x7684;&#x72B6;&#x6001;&#x662F;VISIBLE</div><div class="line">	if (newVisibility == VISIBLE) {</div><div class="line">		// &#x5982;&#x679C;&#x6709;&#x6539;&#x53D8;</div><div class="line">		if ((changed &amp; VISIBILITY_MASK) != 0) {</div><div class="line">			/*</div><div class="line">			 * If this view is becoming visible, invalidate it in case it changed while</div><div class="line">			 * it was not visible. Marking it drawn ensures that the invalidation will</div><div class="line">			 * go through.</div><div class="line">			 */</div><div class="line">			mPrivateFlags |= PFLAG_DRAWN;</div><div class="line">			invalidate(true);</div><div class="line"></div><div class="line">			needGlobalAttributesUpdate(true);</div><div class="line"></div><div class="line">			// a view becoming visible is worth notifying the parent</div><div class="line">			// about in case nothing has focus.  even if this specific view</div><div class="line">			// isn&apos;t focusable, it may contain something that is, so let</div><div class="line">			// the root view try to give this focus if nothing else does.</div><div class="line">			// &#x8FD9;&#x91CC;&#x7684;DecorView&#x7684;Parent&#x662F;ViewRootImpl</div><div class="line">			if ((mParent != null)) {</div><div class="line">				// ViewRootImpl&#x7684;&#x65B9;&#x6CD5;</div><div class="line">				mParent.focusableViewAvailable(this);</div><div class="line">			}</div><div class="line">		}</div><div class="line">	}</div><div class="line"></div><div class="line">	......</div><div class="line">}</div></pre></td></tr></table></figure></p>
<p>&#x8FD9;&#x91CC;&#x5077;&#x61D2;&#x4E86;&#xFF0C;&#x628A;&#x65E0;&#x5173;&#x4EE3;&#x7801;&#x7701;&#x53BB;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x7684;&#x72B6;&#x6001;&#x548C;&#x4EE5;&#x524D;&#x4E0D;&#x4E00;&#x81F4;&#x7684;&#x8BDD;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x6839;&#x636E;&#x72B6;&#x6001;&#x6267;&#x884C;&#x4E0D;&#x540C;&#x8FC7;&#x7A0B;&#x3002;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x8BBE;&#x7F6E;&#x7684;&#x662F;&#x53EF;&#x89C1;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x6267;&#x884C;<code>mParent.focusableViewAvailable(this);</code>&#x65B9;&#x6CD5;&#xFF1A;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line">ViewRootImpl.java:</div><div class="line">@Override</div><div class="line">public void focusableViewAvailable(View v) {</div><div class="line">	checkThread();</div><div class="line">	if (mView != null) {</div><div class="line">		// mView&#x662F;&#x6211;&#x4EEC;&#x7684;DecorView&#xFF0C;&#x6211;&#x4EEC;&#x5E76;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#x5176;&#x83B7;&#x53D6;&#x7126;&#x70B9;</div><div class="line">		if (!mView.hasFocus()) {</div><div class="line">			if (sAlwaysAssignFocus) {</div><div class="line">				// &#x8C03;&#x7528;DecorView&#x7684;requestFocus&#x65B9;&#x6CD5;</div><div class="line">				v.requestFocus();</div><div class="line">			}</div><div class="line">		} else {</div><div class="line">			// the one case where will transfer focus away from the current one</div><div class="line">			// is if the current view is a view group that prefers to give focus</div><div class="line">			// to its children first AND the view is a descendant of it.</div><div class="line">			View focused = mView.findFocus();</div><div class="line">			if (focused instanceof ViewGroup) {</div><div class="line">				ViewGroup group = (ViewGroup) focused;</div><div class="line">				if (group.getDescendantFocusability() == ViewGroup.FOCUS_AFTER_DESCENDANTS</div><div class="line">						&amp;&amp; isViewDescendantOf(v, focused)) {</div><div class="line">					v.requestFocus();</div><div class="line">				}</div><div class="line">			}</div><div class="line">		}</div><div class="line">	}</div><div class="line">}</div><div class="line">requestFocus&#x4F1A;&#x8C03;&#x7528;requestFocus(int direction, Rect previouslyFocusedRect)&#x65B9;&#x6CD5;&#xFF0C;&#x5728;ViewGroup&#x4E2D;&#x91CD;&#x5199;&#xFF0C;&#x8FD9;&#x91CC;&#x7740;&#x91CD;&#x770B;&#x4E0B;&#x3002;</div><div class="line">ViewGroup.java:</div><div class="line">@Override</div><div class="line">public boolean requestFocus(int direction, Rect previouslyFocusedRect) {</div><div class="line">	int descendantFocusability = getDescendantFocusability();</div><div class="line"></div><div class="line">	switch (descendantFocusability) {</div><div class="line">		case FOCUS_BLOCK_DESCENDANTS:</div><div class="line">			// &#x76F4;&#x63A5;&#x53BB;&#x8C03;&#x7528;View&#x7684;requestFocus&#xFF0C;&#x4E0D;&#x7BA1;&#x5B50;View</div><div class="line">			return super.requestFocus(direction, previouslyFocusedRect);</div><div class="line">		case FOCUS_BEFORE_DESCENDANTS: {</div><div class="line">			// &#x5148;&#x4E8E;&#x5B50;View&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7126;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x81EA;&#x8EAB;&#x83B7;&#x53D6;&#x7126;&#x70B9;&#x6210;&#x529F;&#xFF0C;&#x5B50;View&#x4E0D;&#x4F1A;&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7126;&#x70B9;</div><div class="line">			final boolean took = super.requestFocus(direction, previouslyFocusedRect);</div><div class="line">			return took ? took : onRequestFocusInDescendants(direction, previouslyFocusedRect);</div><div class="line">		}</div><div class="line">		case FOCUS_AFTER_DESCENDANTS: {</div><div class="line">			// &#x5148;&#x8BA9;&#x5B50;View&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7126;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x5B50;View&#x83B7;&#x53D6;&#x7126;&#x70B9;&#x6210;&#x529F;&#xFF0C;&#x90A3;&#x4E48;&#x7236;View&#x4E0D;&#x4F1A;&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7126;&#x70B9;</div><div class="line">			final boolean took = onRequestFocusInDescendants(direction, previouslyFocusedRect);</div><div class="line">			return took ? took : super.requestFocus(direction, previouslyFocusedRect);</div><div class="line">		}</div><div class="line">		default:</div><div class="line">			throw new IllegalStateException(&quot;descendant focusability must be &quot;</div><div class="line">					+ &quot;one of FOCUS_BEFORE_DESCENDANTS, FOCUS_AFTER_DESCENDANTS, FOCUS_BLOCK_DESCENDANTS &quot;</div><div class="line">					+ &quot;but is &quot; + descendantFocusability);</div><div class="line">	}</div><div class="line">}</div><div class="line">ViewGroup.java:</div><div class="line">protected boolean onRequestFocusInDescendants(int direction,</div><div class="line">		Rect previouslyFocusedRect) {</div><div class="line">	int index;</div><div class="line">	int increment;</div><div class="line">	int end;</div><div class="line">	int count = mChildrenCount;</div><div class="line">	if ((direction &amp; FOCUS_FORWARD) != 0) {</div><div class="line">		index = 0;</div><div class="line">		increment = 1;</div><div class="line">		end = count;</div><div class="line">	} else {</div><div class="line">		index = count - 1;</div><div class="line">		increment = -1;</div><div class="line">		end = -1;</div><div class="line">	}</div><div class="line">	final View[] children = mChildren;</div><div class="line">	for (int i = index; i != end; i += increment) {</div><div class="line">		View child = children[i];</div><div class="line">		// &#x53EA;&#x5BF9;&#x53EF;&#x89C1;&#x7684;View&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7126;&#x70B9;&#xFF0C;&#x5E76;&#x4E14;&#x4E00;&#x65E6;&#x6709;View&#x83B7;&#x53D6;&#x7126;&#x70B9;&#x5219;&#x4E0D;&#x4F1A;&#x8BA9;&#x5176;&#x4ED6;View&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7126;&#x70B9;</div><div class="line">		if ((child.mViewFlags &amp; VISIBILITY_MASK) == VISIBLE) {</div><div class="line">			if (child.requestFocus(direction, previouslyFocusedRect)) {</div><div class="line">				return true;</div><div class="line">			}</div><div class="line">		}</div><div class="line">	}</div><div class="line">	return false;</div><div class="line">}</div></pre></td></tr></table></figure></p>
<p><code>ViewGroup</code>&#x83B7;&#x53D6;&#x7126;&#x70B9;&#x65F6;&#x9700;&#x8981;&#x6839;&#x636E;<code>descendantFocusability</code>&#x7684;&#x503C;&#x6765;&#x5224;&#x65AD;&#xFF0C;&#x8FD9;&#x91CC;<code>descendantFocusability</code>&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x4E09;&#x4E2A;&#x503C;&#xFF1A;</p>
<ol>
<li>FOCUS_BLOCK_DESCENDANTS&#xFF1A;<strong>&#x7236;View&#x76F4;&#x63A5;&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7126;&#x70B9;&#x3002;</strong></li>
<li>FOCUS_BEFORE_DESCENDANTS&#xFF1A;<strong>&#x7236;View&#x4F1A;&#x4F18;&#x5148;&#x5176;&#x5B50;View&#xFF0C;&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7126;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x83B7;&#x53D6;&#x5230;&#x7126;&#x70B9;&#xFF0C;&#x5219;&#x4F1A;&#x8BA9;&#x5176;&#x5B50;View&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7126;&#x70B9;&#x3002;</strong></li>
<li>FOCUS_AFTER_DESCENDANTS&#xFF1A;<strong>&#x4E0E;FOCUS_BEFORE_DESCENDANTS&#x76F8;&#x53CD;&#xFF0C;&#x5B50;View&#x4F1A;&#x5148;&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7126;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x83B7;&#x53D6;&#x5230;&#x7126;&#x70B9;&#xFF0C;&#x90A3;&#x4E48;&#x7236;View&#x4E0D;&#x4F1A;&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7126;&#x70B9;&#x3002;</strong></li>
</ol>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;ViewGroup&#x5728;&#x521D;&#x59CB;&#x5316;&#x7684;&#x65F6;&#x5019;&#x8BBE;&#x7F6E;&#x4E3A;<code>FOCUS_BEFORE_DESCENDANTS</code>&#xFF0C;&#x4F46;&#x662F;<code>DecorView</code>&#x8BBE;&#x7F6E;&#x4E3A;<code>FOCUS_AFTER_DESCENDANTS</code><br><img src="http://upload-images.jianshu.io/upload_images/5720362-465dbfe021266592.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>&#x597D;&#x4E86;&#xFF0C;&#x5230;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x4E3A;&#x4EC0;&#x4E48;&#x521A;&#x624D;&#x7684;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x4E86;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x5982;&#x679C;&#x6539;&#x6210;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x8BD5;&#x8BD5;&#x4E86;&#xFF1A;<br><img src="http://upload-images.jianshu.io/upload_images/5720362-ce8b4a43e758a1c3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>&#x6B64;&#x65F6;&#xFF0C;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x6267;&#x884C;&#x4F1A;&#x51FA;&#x73B0;&#xFF1A;View1&#x83B7;&#x53D6;&#x7126;&#x70B9;&#x540E;&#xFF0C;&#x70B9;&#x51FB;&#x6B63;&#x5E38;&#xFF0C;&#x70B9;&#x51FB;View2&#xFF0C;&#x65E0;&#x53CD;&#x5E94;&#xFF0C;&#x518D;&#x6B21;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x6B63;&#x5E38;&#x3002;<br>&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x5206;&#x6790;&#x7EE7;&#x7EED;&#x6765;&#xFF1A;<br>&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x6761;&#x4EF6;&#x6210;&#x7ACB;&#x540E;&#x4F1A;&#x901A;&#x8FC7;<code>Handler</code>&#x53D1;&#x9001;<code>PerformClick</code>&#x5BF9;&#x8C61;&#xFF0C;&#x5982;&#x679C;&#x53D1;&#x9001;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x6267;&#x884C;<code>PerformClick.run</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5426;&#x5219;&#x6267;&#x884C;<code>performClick()</code>&#x65B9;&#x6CD5;&#xFF08;<code>PerformClick.run</code>&#x4E5F;&#x8C03;&#x7528;&#x4E86;<code>performClick</code>&#x65B9;&#x6CD5;&#xFF09;&#xFF0C;&#x6700;&#x7EC8;&#x6267;&#x884C;<code>OnClickListener</code>&#x7684;<code>onClick</code>&#x65B9;&#x6CD5;&#x3002;<br><img src="http://upload-images.jianshu.io/upload_images/5720362-8d12cea30a0510d7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="performClick"></p>
<h1 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h1><p>&#x5199;&#x4E86;&#x8FD9;&#x4E48;&#x591A;&#xFF0C;&#x8FD8;&#x662F;&#x6765;&#x4E2A;&#x603B;&#x7ED3;&#x5427;&#xFF1A;</p>
<ol>
<li><strong>&#x5728;&#x6309;&#x4E0B;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x957F;&#x6309;&#x4E8B;&#x4EF6;&#x6267;&#x884C;&#x4E86;&#xFF0C;&#x5E76;&#x4E14;&#x8FD4;&#x56DE;&#x503C;&#x4E3A;false&#xFF0C;&#x90A3;&#x4E48;&#x6B64;&#x65F6;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x4E0D;&#x4F1A;&#x6267;&#x884C;&#xFF1B;&#x53CD;&#x4E4B;&#x5219;&#x4F1A;&#x6267;&#x884C;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x3002;</strong></li>
<li><strong>&#x5173;&#x4E8E;ViewGroup&#x548C;&#x5B50;View&#x83B7;&#x53D6;&#x7126;&#x70B9;&#x7684;&#x5148;&#x540E;&#x987A;&#x5E8F;&#xFF0C;&#x6839;&#x636E;<code>descendantFocusability</code>&#x7684;&#x503C;&#x6765;&#x5224;&#x65AD;&#xFF1A;</strong><br>FOCUS_BLOCK_DESCENDANTS&#xFF1A;<strong>&#x7236;View&#x76F4;&#x63A5;&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7126;&#x70B9;&#x3002;</strong><br>FOCUS_BEFORE_DESCENDANTS&#xFF1A;<strong>&#x7236;View&#x4F1A;&#x4F18;&#x5148;&#x5176;&#x5B50;View&#xFF0C;&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7126;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x83B7;&#x53D6;&#x5230;&#x7126;&#x70B9;&#xFF0C;&#x5219;&#x4F1A;&#x8BA9;&#x5176;&#x5B50;View&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7126;&#x70B9;&#x3002;</strong><br>FOCUS_AFTER_DESCENDANTS&#xFF1A;<strong>&#x4E0E;FOCUS_BEFORE_DESCENDANTS&#x76F8;&#x53CD;&#xFF0C;&#x5B50;View&#x4F1A;&#x5148;&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7126;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x83B7;&#x53D6;&#x5230;&#x7126;&#x70B9;&#xFF0C;&#x90A3;&#x4E48;&#x7236;View&#x4E0D;&#x4F1A;&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7126;&#x70B9;&#x3002;</strong></li>
<li><strong>&#x5982;&#x679C;&#x540C;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#x4E2D;&#xFF0C;&#x6709;&#x591A;&#x4E2A;View&#x90FD;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x7126;&#x70B9;&#xFF0C;&#x90A3;&#x4E48;&#x53EA;&#x6709;&#x5F53;&#x524D;&#x83B7;&#x53D6;&#x7126;&#x70B9;&#x7684;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x6267;&#x884C;&#xFF0C;&#x5176;&#x4ED6;View&#x9700;&#x8981;&#x5148;&#x70B9;&#x51FB;&#x4E00;&#x6B21;&#x83B7;&#x53D6;&#x7126;&#x70B9;&#xFF0C;&#x4E4B;&#x540E;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x6267;&#x884C;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x3002;</strong></li>
</ol>
<p>OK&#xFF0C;&#x8FD9;&#x7BC7;&#x5206;&#x6790;&#x5230;&#x6B64;&#x7ED3;&#x675F;&#x4E86;&#x3002;&#x5982;&#x679C;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x8BF7;&#x6307;&#x51FA;&#xFF08;&#x4F30;&#x8BA1;&#x4E5F;&#x5C31;&#x662F;&#x81EA;&#x5DF1;&#x6765;&#x53D1;&#x73B0;&#x95EE;&#x9898;&#x5427;&#xFF09;&#x3002;<br>&#x8FD9;&#x91CC;&#x591A;&#x8BF4;&#x51E0;&#x53E5;&#xFF1A;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x89C9;&#x5F97;&#x8BB8;&#x591A;&#x535A;&#x5BA2;&#x5206;&#x6790;&#x7684;&#x771F;&#x7684;&#x662F;&#x5934;&#x5934;&#x662F;&#x9053;&#xFF0C;&#x5F53;&#x8F6E;&#x5230;&#x6211;&#x53BB;&#x5206;&#x6790;&#x67D0;&#x4E9B;&#x4E1C;&#x897F;&#x7684;&#x65F6;&#x5019;&#x518D;&#x53BB;&#x770B;&#x4ED6;&#x4EEC;&#x7684;&#x535A;&#x5BA2;&#x5374;&#x53D1;&#x73B0;&#xFF1A;&#x597D;&#x591A;&#x4E1C;&#x897F;&#x90FD;&#x8BF4;&#x7684;&#x4E0D;&#x660E;&#x786E;&#xFF0C;&#x592A;&#x6A21;&#x7CCA;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x81EA;&#x5DF1;&#x5206;&#x6790;&#x7684;&#x65F6;&#x5019;&#x5C3D;&#x91CF;&#x628A;&#x6240;&#x6709;&#x8FC7;&#x7A0B;&#x5168;&#x90E8;&#x5206;&#x6790;&#x5B8C;&#x6210;&#xFF0C;&#x4E89;&#x53D6;&#x6B65;&#x9AA4;&#x5B8C;&#x6574;&#xFF0C;&#x65B9;&#x4FBF;&#x4EE5;&#x540E;&#x81EA;&#x5DF1;&#x56DE;&#x987E;&#x3002;<br>That&#x2019;s all!<br><img src="http://upload-images.jianshu.io/upload_images/5720362-7ba0e9f79e8e5479.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/12/20/Android触摸事件（下）——事件的分发/" rel="next" title="Android触摸事件（下）——事件的分发">
                <i class="fa fa-chevron-left"></i> Android触摸事件（下）——事件的分发
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/01/15/Android Binder——通过AIDL探究Binder/" rel="prev" title="Android Binder——通过AIDL探究Binder">
                Android Binder——通过AIDL探究Binder <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/favicon.png"
               alt="Nick Kang" />
          <p class="site-author-name" itemprop="name">Nick Kang</p>
          <p class="site-description motion-element" itemprop="description">风轻云淡，勿忘本心</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#onTouchEvent会迟到，有时也会缺席"><span class="nav-number">1.</span> <span class="nav-text">onTouchEvent会迟到，有时也会缺席</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#总结"><span class="nav-number">2.</span> <span class="nav-text">总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Nick Kang</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  




  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

  


</body>
</html>
